<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>FALLENINTODUST</title>
<style>
body { margin:0; overflow:hidden; background:#000; font-family:Arial }
#ui {
    position:fixed;
    top:10px;
    left:10px;
    color:white;
    font-size:18px;
    z-index:10;
}
</style>
</head>
<body>

<div id="ui">HP: <span id="hp">100</span></div>

<script src="https://cdn.jsdelivr.net/npm/three@0.161.0/build/three.min.js"></script>

<script>
/* ===== BASIC SCENE ===== */
const scene = new THREE.Scene()
scene.background = new THREE.Color(0x202533)

/* ===== CAMERA ===== */
const camera = new THREE.PerspectiveCamera(75, innerWidth/innerHeight, 0.1, 500)
camera.position.set(0,5,10)

/* ===== RENDERER ===== */
const renderer = new THREE.WebGLRenderer({ antialias:true })
renderer.setSize(innerWidth, innerHeight)
renderer.shadowMap.enabled = true
document.body.appendChild(renderer.domElement)

/* ===== LIGHT ===== */
const light = new THREE.DirectionalLight(0xffffff, 1)
light.position.set(10,20,10)
light.castShadow = true
scene.add(light)
scene.add(new THREE.AmbientLight(0x555555))

/* ===== GROUND ===== */
const ground = new THREE.Mesh(
    new THREE.PlaneGeometry(200,200),
    new THREE.MeshStandardMaterial({ color:0x3a3a3a })
)
ground.rotation.x = -Math.PI/2
ground.receiveShadow = true
scene.add(ground)

/* ===== DEBUG CUBE (PROVES IT WORKS) ===== */
const debugCube = new THREE.Mesh(
    new THREE.BoxGeometry(2,2,2),
    new THREE.MeshStandardMaterial({ color:0xff0000 })
)
debugCube.position.y = 1
debugCube.castShadow = true
scene.add(debugCube)

/* ===== PLAYER ===== */
const player = new THREE.Group()
player.position.y = 1
scene.add(player)

const body = new THREE.Mesh(
    new THREE.BoxGeometry(1,2,1),
    new THREE.MeshStandardMaterial({ color:0x4b61ff })
)
body.castShadow = true
player.add(body)

const sword = new THREE.Mesh(
    new THREE.BoxGeometry(0.15,1.6,0.15),
    new THREE.MeshStandardMaterial({ color:0xcccccc })
)
sword.position.set(0.8,0.3,0)
player.add(sword)

/* ===== SKELETON ===== */
function createSkeleton(x,z){
    const s = new THREE.Group()
    const mat = new THREE.MeshStandardMaterial({ color:0xe5e5e5 })

    const torso = new THREE.Mesh(new THREE.BoxGeometry(0.8,1.2,0.4), mat)
    torso.position.y = 1.2
    s.add(torso)

    const head = new THREE.Mesh(new THREE.SphereGeometry(0.35,12,12), mat)
    head.position.y = 2
    s.add(head)

    s.position.set(x,1,z)
    s.hp = 30
    scene.add(s)
    return s
}

const skeletons = [
    createSkeleton(5,5),
    createSkeleton(-6,-4)
]

/* ===== CONTROLS ===== */
const keys = {}
addEventListener("keydown",e=>keys[e.key.toLowerCase()]=true)
addEventListener("keyup",e=>keys[e.key.toLowerCase()]=false)

let swinging = false
addEventListener("mousedown",()=>{
    if(swinging) return
    swinging = true
    sword.rotation.z = -1.2
    setTimeout(()=>{
        sword.rotation.z = 0
        swinging = false
    },200)
})

/* ===== STATS ===== */
let hp = 100
const hpUI = document.getElementById("hp")

/* ===== LOOP ===== */
function animate(){
    requestAnimationFrame(animate)

    const speed = 0.12
    if(keys["w"]) player.translateZ(-speed)
    if(keys["s"]) player.translateZ(speed)
    if(keys["a"]) player.rotation.y += 0.05
    if(keys["d"]) player.rotation.y -= 0.05

    camera.position.lerp(
        player.position.clone().add(new THREE.Vector3(0,5,10)),
        0.1
    )
    camera.lookAt(player.position)

    skeletons.forEach(s=>{
        if(s.hp<=0) return
        s.lookAt(player.position)
        s.translateZ(0.03)

        if(s.position.distanceTo(player.position)<1.5){
            hp -= 0.2
            hpUI.textContent = Math.max(0,Math.floor(hp))
        }

        if(swinging && s.position.distanceTo(player.position)<2){
            s.hp -= 10
            s.scale.y = s.hp/30
            if(s.hp<=0) scene.remove(s)
        }
    })

    renderer.render(scene,camera)
}
animate()

addEventListener("resize",()=>{
    camera.aspect = innerWidth/innerHeight
    camera.updateProjectionMatrix()
    renderer.setSize(innerWidth,innerHeight)
})
</script>
</body>
</html>
